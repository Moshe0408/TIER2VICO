# -*- coding: utf-8 -*-
import win32com.client as win32
import os
import pytz
import datetime
import csv
import random
import shutil
import tempfile
import requests

# ===== × ×ª×•× ×™× =====

# ×©×™××•×© ×‘× ×ª×™×‘ ××‘×¡×•×œ×•×˜×™ ×œ×ª××•× ×”
SCRIPT_DIR = os.path.dirname(os.path.abspath(__file__))
IMAGE_FILENAME = os.path.join(SCRIPT_DIR, "customer_service_tip.png")
RECIPIENTS_CSV = os.path.join(SCRIPT_DIR, "recipients.csv")

# ×¨×©×™××ª ×˜×™×¤×™× (×œ×‘×§×©×ª ×”××©×ª××© - ×¨×¢× ×•×Ÿ 2026)
ALL_TIPS = [
    "×”×œ×§×•×— ××•××¨ '×œ× × ×’×¢×ª×™ ×‘×›×œ×•×'? ×ª×ª×¨×’× ×œ'× ×™×¡×™×ª×™ ×œ×ª×§×Ÿ ××ª ×–×” ×¢× ××–×œ×’ ×•×¢×›×©×™×• ×”×›×œ ××§×¦×¨'. ğŸ´âš¡",
    "××¡×•×£ ×œ× ××’×™×‘? ××•×œ×™ ×”×•× ×¦×¨×™×š ×¨×’×¢ ×œ×—×©×•×‘ ×¢×œ ×”××©××¢×•×ª ×©×œ '×—×™×•×‘ ××•×¦×œ×—'. ğŸ¤”ğŸ’³",
    "×”××“×¤×¡×ª ×œ× ××•×¦×™××” × ×™×™×¨? ×ª×‘×“×•×§ ×× ×©××ª ×’×œ×™×œ ××• ×©××ª×” ×¡×•××š ×¢×œ ×›×— ×”××—×©×‘×”. ğŸ§ ğŸ“œ",
    "×ª×§×œ×” ×‘×§×•×¤×” ×‘×™×•× ×—××™×©×™ ×‘-19:55? ×–×” ×œ× ×‘××’, ×–×” ×”×™×§×•× ××•××¨ ×œ×š '×œ×š ×”×‘×™×ª×”'. ğŸ ğŸŒŒ",
    "×”×œ×§×•×— ×©×•××œ ×× ××¤×©×¨ ×œ×¢×§×•×£ ××ª ×”×§×•×“ ×”×¡×•×“×™? ×ª×¦×™×¢ ×œ×• ×œ×¢×§×•×£ ××ª ×—×•×§×™ ×”×¤×™×–×™×§×”. ğŸ›¸ğŸ›¡ï¸",
    "× ×•×¨×™×ª ××“×•××” ××”×‘×”×‘×ª? ×–×” ××•××¨ ×©×”××¡×•×£ × ×›× ×¡ ×œ××¦×‘ '×œ×—×¥ ×¡×•×¦×™××œ×™'. ğŸ”´ğŸ˜±",
    "×”××¡×š ××’×¢ ×œ× ×¢×•×‘×“? ×ª× ×§×” ××ª ×”×—×•××•×¡ ××”××¦×‘×¢, ×–×” ×¢×•×–×¨ ×¤×œ××™×. ğŸ§†â˜ï¸",
    "××™×Ÿ ×ª×§×©×•×¨×ª? ×”××¡×•×£ ×•×”×¨××•×˜×¨ ×‘×“×™×•×§ ×‘×××¦×¢ ×¨×™×‘ ×–×•×’×™. ×ª×Ÿ ×œ×”× ×“×§×”. ğŸ“¶ğŸ’”",
    "×”×œ×§×•×— ××•××¨ '×–×” ×¢×‘×“ ××ª××•×œ'? ×’× ×× ×™ ×”×™×™×ª×™ ×¦×¢×™×¨ ×•×™×¤×” ××ª××•×œ. ×“×‘×¨×™× ××©×ª× ×™×. ğŸ‘´âœ¨",
    "×”-P400 ×¢×•×©×” ×¨×¢×© ×©×œ ××›×•× ×ª ×›×‘×™×¡×”? ×”×•× ×¤×©×•×˜ ×× ×¡×” ×œ×›×‘×¡ ××ª ×”×›×¡×£ ×©×œ ×”×œ×§×•×—. ğŸ§¼ğŸ’¸",
    "×”××§×œ×“×ª ×‘×¡×™× ×™×ª? ×›× ×¨××” ×©×”×—×ª×•×œ ×©×œ ×”×œ×§×•×— × ×™×¡×” ×œ×”×–××™×Ÿ ××©×œ×•×— ×××œ×™-××§×¡×¤×¨×¡. ğŸˆğŸ§§",
    "×”×œ×§×•×— ×©×•××œ '×œ××” ×–×” ×œ×•×§×— ×–××Ÿ?' - ×ª×¢× ×”: '×× ×—× ×• ××—×›×™× ×©×”×‘×™×˜×™× ×™×¡×™×™××• ××ª ×”×§×¤×”'. â˜•ğŸ’¾",
    "××¡×•×£ ×ª×œ×•×© ××”×§×™×¨? ×–×” ×œ× '× ×ª×§', ×–×” '×©××™×¤×” ×œ×—×•×¤×©'. ğŸ•Šï¸ğŸ”Œ",
    "×”×œ×§×•×— ××•××¨ '×–×” ×ª××™×“ ×¢×‘×“ ×›×›×”' ×¢×œ ×ª×§×œ×” ×‘×¨×•×¨×”? ×”×•× ×›× ×¨××” ×‘×©×œ×‘ ×”×”×›×—×©×”. ğŸ™ˆğŸ“ˆ",
    "×©×’×™××ª ×ª×§×©×•×¨×ª 001? ×”××¡×•×£ ×¤×©×•×˜ ×‘×™×™×©×Ÿ ×•××¤×—×“ ×œ×“×‘×¨ ×¢× ×©×‘×. ğŸ«£ğŸ“¡",
    "×”××¡×š ×©×œ ×”×§×•×¤×” ×©×—×•×¨? ××•×œ×™ ×”×™× ×¤×©×•×˜ ××©×—×§×ª '××—×‘×•××™×' ×¢× ×”× ×ª×•× ×™×. ğŸ­ğŸ–¥ï¸",
    "×”×œ×§×•×— ×¦×•×¢×§? ×ª×–×›×•×¨: ×–×” ×œ× ××ª×”, ×–×” ×”×˜×•×Ÿ ×©×œ ×”×œ×§×•×— ×©×œ× ××¡×ª× ×›×¨×Ÿ ×¢× ×”××¦×™××•×ª. ğŸ§˜â€â™‚ï¸ğŸ¶",
    "×”×‘×¨×§×•×“ ×œ× × ×¡×¨×§? ×ª× ×¡×” ×œ×©×™×¨ ×œ×•, ××•×œ×™ ×”×•× ×¦×¨×™×š ×§×¦×ª ××•×˜×™×‘×¦×™×”. ğŸ¤ğŸ”¦",
    "×©×›×—×• ××ª ×”×¡×™×¡××”? ×ª×¦×™×¢ '1234' - ×”××–×œ ×ª××™×“ ×¢×•×–×¨ ×œ××™ ×©××¢×–. ğŸ”¢ğŸ€",
    "×”××¡×•×£ ×›×•×ª×‘ '× × ×¢×œ ×¢×§×‘ ×—×‘×œ×”'? ×ª×’×™×“ ×œ×œ×§×•×— ×©×–×” ×œ× ×©×§ ××’×¨×•×£, ×–×” ××¡×•×£ ××©×¨××™. ğŸ”¨ğŸ˜±",
    "×¨×™×— ×©×œ ×©×¨×•×£? ××œ ×“××’×”, ××œ×• ×¨×§ ×”×¨×¢×™×•× ×•×ª ×”××‘×¨×™×§×™× ×©×œ ×”×¦×•×•×ª ×©×¢×•×‘×“×™× ×§×©×”. ğŸ”¥ğŸ§ ",
    "×”×œ×§×•×— ××•××¨ '×× ×™ ×œ× ×˜×›× ×•×œ×•×’×™' - ×–×” ×”×§×•×“ ×œ'×ª×¢×©×” ×”×›×œ ×‘××§×•××™ ×•×× ×™ ×¤×©×•×˜ ××¡×ª×›×œ'. ğŸ›‹ï¸ğŸ› ï¸",
    "×”××¡×•×£ ××•×¦×™× '×“×£ ×œ×‘×Ÿ'? ×”×•× ×¤×©×•×˜ ×¨×•×¦×” ×©×ª×›×ª×•×‘ ×¢×œ×™×• ×©×™×¨ ××”×‘×” ×œ×ª××™×›×”. ğŸ“â¤ï¸",
    "×ª×§×œ×” ×‘×¢×¨×‘ ×—×’? ×–×” ×”×“×¨×š ×©×œ ×”×’×•×¨×œ ×œ×‘×“×•×§ ×›××” ×¡×‘×œ× ×•×ª × ×©××¨×” ×œ×š ××—×¨×™ ×”×§× ×™×•×ª. ğŸğŸ¯",
    "×”×œ×§×•×— ×©×•××œ '×–×” ×™×¢×‘×•×“ ×œ× ×¦×—?' - ×ª×¢× ×”: '×¢×“ ×”×¢×“×›×•×Ÿ ×”×‘×, ××• ×¢×“ ×©×™×¤×•×œ ×¢×œ×™×• ×§×¤×”'. â˜•ğŸ“…",
    "×”×¢×›×‘×¨ ×œ× ×–×–? ×ª×‘×“×•×§ ×× ×”×•× ×œ× ××ª ××¨×¢×‘ (××• ×©×¤×©×•×˜ ×”×›×‘×œ ×‘×—×•×¥). ğŸ­ğŸ”Œ",
    "×©×’×™××” ×œ× ××–×•×”×”? ×–×” ×¤×©×•×˜ ×”××—×©×‘ ×©×× ×¡×” ×œ×”×™×•×ª ××¡×ª×•×¨×™ ×•××¢× ×™×™×Ÿ. ğŸ•µï¸â€â™‚ï¸ğŸ’»",
    "×”××¢×¨×›×ª ××™×˜×™×ª? ×”×™× ×œ× ××™×˜×™×ª, ×”×™× '×‘××—×©×‘×” ×¢××•×§×” ×¢×œ ×”×¦×¢×“ ×”×‘×'. ğŸ¢ğŸ’­",
    "×”×œ×§×•×— ××•××¨ '× ×™×¡×™×ª×™ ×”×›×œ' - ×—×•×¥ ××”×“×‘×¨ ×”××—×“ ×©×‘×××ª ×¤×•×ª×¨ ××ª ×”×‘×¢×™×”. ğŸ†ğŸ”§",
    "× ×™×¡×™×ª ×œ×›×‘×•×ª ×•×œ×”×“×œ×™×§? ×”×§×¡× ×”×›×™ ×™×©×Ÿ ×‘×¡×¤×¨, ×•×¢×“×™×™×Ÿ ×¢×•×‘×“ ×™×•×ª×¨ ××›×œ ×ª×•××¨ ×‘-MIT. ğŸ”„ğŸª„",
    "×”×œ×§×•×— ×××™×™× ×œ×¢×–×•×‘? ×ª×–×›×•×¨: ×‘×—×•×¥ ×™×© ×ª×§×œ×•×ª ×”×¨×‘×” ×™×•×ª×¨ ×’×¨×•×¢×•×ª, ×× ×—× ×• ×œ×¤×—×•×ª × ×—××“×™×. ğŸ˜ŠğŸ›¡ï¸",
    "×”××¡×š ×©×œ ×”-V400 × ×”×™×” ×•×¨×•×“? ×”×•× ×¤×©×•×˜ ×××•×”×‘ ×‘×©×™×¨×•×ª ×”××¦×•×™×Ÿ ×©×œ×š. ğŸ’–ğŸ“Ÿ",
    "×”×œ×§×•×— ××•××¨ '×–×” ×§×¨×” ×¤×ª××•×' - ×‘×“×™×•×§ ××—×¨×™ ×©×”×•× ×©×¤×š ×¢×œ×™×• ×’×œ×•×Ÿ ×©×œ ××™× ×¨×•×ª×—×™×. ğŸ’§ğŸ”¥",
    "×ª×§×œ×” ×’×•×¨×¤×ª? ×–×” ×œ× '××©×‘×¨', ×–×” '××¡×™×‘×ª ×¢×“×›×•× ×™× ×œ× ××ª×•×›× × ×ª'. ğŸŠğŸ“‰",
    "×¡×™×™××ª ×©×™×—×” ×‘×”×¦×œ×—×”? ×ª×Ÿ ×œ×¢×¦××š ×˜×¤×™×—×” ×¢×œ ×”×©×›×, ×”×¨×’×¢ ×”×¦×œ×ª ××ª ×”×¢×•×œ× (××• ×œ×¤×—×•×ª ×§× ×™×™×” ×‘×¡×•×¤×¨). ğŸŒğŸ›’",
]

# ×¨×©×™××ª GIFs ××©×ª× ×™× ×•××©×¢×©×¢×™× (Verified CDN Links - Buzzfeed/Imgur)
ALL_GIFS = [
    "https://img.buzzfeed.com/buzzfeed-static/static/2020-02/13/13/asset/68dc30da732b/anigif_sub-buzz-1034-1581602081-1.gif",
    "https://img.buzzfeed.com/buzzfeed-static/static/2020-02/13/13/asset/9b0705fe7d02/anigif_sub-buzz-363-1581602092-1.gif",
    "https://img.buzzfeed.com/buzzfeed-static/static/2020-02/13/15/asset/27f6d020c948/anigif_sub-buzz-2723-1581609514-1.gif",
    "https://i.imgur.com/6w2SOpz.gif",
    "https://i.imgur.com/RezqZWZ.gif",
    "https://i.imgur.com/xwm7z96.gif",
    "https://i.imgur.com/MzFCtct.gif",
    "https://i.imgur.com/9mwloRL.gif",
    "https://img.buzzfeed.com/buzzfeed-static/static/2020-02/13/14/asset/5bb055a630d4/anigif_sub-buzz-2590-1581602994-1.gif"
]

# ===== ×œ×•×’×™×§×” =====

def get_daily_greeting():
    israel_tz = pytz.timezone('Asia/Jerusalem')
    now = datetime.datetime.now(israel_tz)
    weekday = now.weekday()  # Monday=0, Sunday=6
    
    # ××™×¤×•×™ ×™××™× ×œ×‘×¨×›×•×ª
    greetings = {
        6: "âœ¨ ×‘×•×§×¨ ××•×¨! ×©×‘×•×¢ ×—×“×©, ×× ×¨×’×™×•×ª ×—×“×©×•×ª!",      # Sunday
        0: "ğŸ’ª ×™×•× ×©× ×™ â€“ ×›×‘×¨ × ×›× ×¡× ×• ×œ×§×¦×‘!",              # Monday
        1: "ğŸš€ ×™×•× ×©×œ×™×©×™ â€“ ×¤×¢××™×™× ×›×™ ×˜×•×‘!",             # Tuesday
        2: "ğŸŒŸ ×™×•× ×¨×‘×™×¢×™ â€“ ×××¦×¢ ×”×©×‘×•×¢, ×× ×—× ×• ×¢×œ ×”×’×œ!",    # Wednesday
        3: "ğŸ‰ ×™×•× ×—××™×©×™ ×”×’×™×¢! ×”×¡×•×¤\"×© ××¢×‘×¨ ×œ×¤×™× ×”!",      # Thursday
    }
    # 4=Friday, 5=Saturday (× ×¡× ×Ÿ ××•×ª× ×‘×œ×•×’×™×§×” ×”×¨××©×™×ª)
    
    return greetings.get(weekday, "×™×•× × ×¤×œ×!")

def get_tip_and_gif():
    """
    ×‘×•×—×¨ ×˜×™×¤ ×•-GIF ×”××‘×•×¡×¡×™× ×¢×œ ×”×™×•× ×‘×©× ×” ×›×“×™ ×œ×”×‘×˜×™×— ×©×›×œ ×™×•× ×™×”×™×” ×ª×•×›×Ÿ ×©×•× ×”.
    """
    israel_tz = pytz.timezone('Asia/Jerusalem')
    now = datetime.datetime.now(israel_tz)
    day_of_year = now.timetuple().tm_yday
    
    tip = ALL_TIPS[day_of_year % len(ALL_TIPS)] if ALL_TIPS else "××™×Ÿ ×˜×™×¤×™× ×–××™× ×™×."
    gif = ALL_GIFS[day_of_year % len(ALL_GIFS)] if ALL_GIFS else ""
    
    return tip, gif

def read_recipients():
    """×§×¨×™××ª ×”× ××¢× ×™× ××§×•×‘×¥ ×”-CSV ×”××§×•××™"""
    emails = []
    if not os.path.exists(RECIPIENTS_CSV):
        print(f"FAILED: Recipients file not found: {RECIPIENTS_CSV}")
        return emails
        
    encodings = ['utf-8', 'utf-8-sig', 'windows-1255', 'latin-1']
    content = None
    
    for enc in encodings:
        try:
            with open(RECIPIENTS_CSV, encoding=enc) as csvfile:
                # ×‘×“×™×§×” ×× ×”×§×•×‘×¥ ×¨×™×§ ××• ×œ× ×ª×§×™×Ÿ
                content = csvfile.read()
                if content:
                    # ×—×–×¨×” ×œ×ª×—×™×œ×ª ×”×§×•×‘×¥ ×œ×§×¨×™××” ×¢× DictReader
                    csvfile.seek(0)
                    reader = csv.DictReader(csvfile)
                    for row in reader:
                        email = row.get("email", "").strip()
                        if email and "@" in email:
                            emails.append(email)
                    if emails:
                        print(f"âœ… ×”×§×•×‘×¥ × ×§×¨× ×‘×”×¦×œ×—×” ×‘×§×™×“×•×“: {enc}")
                        break
        except Exception:
            continue
            
    if not emails and content:
        print("ALERT: No valid emails found in file. Check for 'email' column.")
    elif not emails:
        print("FAILED: Could not read file with supported encodings.")
        
    return emails

def send_daily_email():
    israel_tz = pytz.timezone('Asia/Jerusalem')
    now = datetime.datetime.now(israel_tz)
    current_weekday = now.weekday() 
    
    # 4 = Friday, 5 = Saturday
    if current_weekday in [4, 5]:
        print(f"ğŸ“… ×”×™×•× {now.strftime('%A')} (×¡×•×¤\"×©) - ×”××¢×¨×›×ª × ×—×”.")
        return
 

    recipients_emails = read_recipients()
    if not recipients_emails:
        print("FAILED: No recipients found (file missing or empty).")
        return

    # ×‘×—×™×¨×ª ×ª×•×›×Ÿ
    greeting = get_daily_greeting()
    tip_text, selected_gif_url = get_tip_and_gif()
    
    # Download GIF to attach as CID (Most reliable for Outlook)
    temp_gif_path = None
    if selected_gif_url:
        try:
            print(f"ğŸ¬ ××•×¨×™×“ GIF ×œ×”×˜××¢×”: {selected_gif_url}")
            headers = {
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
                'Accept': 'image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8'
            }
            # Add Referer based on domain
            if "buzzfeed" in selected_gif_url:
                headers['Referer'] = 'https://www.buzzfeed.com/'
            elif "imgur" in selected_gif_url:
                headers['Referer'] = 'https://imgur.com/'
            r = requests.get(selected_gif_url, stream=True, timeout=20, headers=headers)
            print(f"   [D] ×¡×˜×˜×•×¡ ×”×•×¨×“×”: {r.status_code}")
            
            # ×‘×“×™×§×” ×× ×”×ª×•×›×Ÿ ×§×¦×¨ ××“×™ (×›× ×¨××” placeholder ×©×œ ×©×’×™××”)
            content_size = int(r.headers.get('Content-Length', 0))
            if r.status_code == 200 and content_size > 5000:
                temp_dir = tempfile.gettempdir()
                temp_gif_path = os.path.join(temp_dir, f"tip_gif_{now.strftime('%H%M%S')}.gif")
                with open(temp_gif_path, 'wb') as f:
                    shutil.copyfileobj(r.raw, f)
                print(f"   [V] GIF × ×©××¨ ×–×× ×™×ª ×‘: {temp_gif_path} (×’×•×“×œ: {content_size} bytes)")
            else:
                print(f"   [!] ××–×”×¨×”: ×”×§×•×‘×¥ ×§×˜×Ÿ ××“×™ ××• ×©×’×™××ª ×©×¨×ª ({r.status_code})")
        except Exception as e:
            print(f"   [!] ××–×”×¨×”: ×œ× × ×™×ª×Ÿ ×”×™×” ×œ×”×•×¨×™×“ ××ª ×”-GIF: {e}")

    # ×¢×™×¦×•×‘ HTML ×™×•×§×¨×ª×™, ×××•×¨×›×– ×•× ×§×™
    html_body = f"""
    <!DOCTYPE html>
    <html lang="he" dir="rtl">
    <head>
    <meta charset="UTF-8">
    <style>
        body {{
            margin: 0;
            padding: 0;
            background-color: #f4f7f9;
            font-family: Arial, Helvetica, sans-serif;
            direction: rtl;
        }}
        .email-container {{
            max-width: 600px;
            margin: 20px auto;
            background-color: #ffffff;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #d1d9e0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }}
        .header {{
            background-color: #0052cc;
            color: #ffffff;
            padding: 25px 20px;
            text-align: center;
        }}
        .header h1 {{
            margin: 0;
            font-size: 24px;
            font-weight: bold;
        }}
        .content {{
            padding: 35px 25px;
            text-align: center;
        }}
        .tip-box {{
            background-color: #f0f7ff;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
        }}
        .tip-text {{
            font-size: 22px;
            color: #1a1f23;
            line-height: 1.6;
            margin: 0;
            font-weight: bold;
        }}
        .funny-gif {{
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }}
        .greeting {{
            font-size: 20px;
            color: #0052cc;
            margin-top: 15px;
            font-weight: bold;
        }}
        .footer {{
            padding: 15px;
            text-align: center;
            background-color: #fcfdfe;
            color: #6a737d;
            font-size: 13px;
            border-top: 1px solid #e1e4e8;
        }}
        .verifone-link {{
            color: #0052cc;
            text-decoration: none;
            font-weight: bold;
        }}
    </style>
    </head>
    <body>
        <div class="email-container">
            <div class="header">
                <h1>ğŸ’¡ ×”×˜×™×¤ ×”×™×•××™ ×©×œ×š</h1>
            </div>
            
            <div class="content">
                <div class="tip-box">
                    <p class="tip-text">
                        {tip_text}
                    </p>
                </div>

                {f'<img src="cid:daily_visual" alt="Customer Service Fun" class="funny-gif">' if temp_gif_path else ''}

                <div class="greeting">
                    {greeting}
                </div>
            </div>

            <div class="footer">
               ×©×œ ××©×” × ×©×œ×— ×‘××•×¤×Ÿ ××•×˜×•××˜×™ â€¢ <b>×’×¨×¡×” 2.3</b>
                <br>
                <span class="verifone-link">Verifone Team</span> â€¢ {now.year}
            </div>
        </div>
    </body>
    </html>
    """


    # ×”×©×•×œ×— ×”×•× ×’× ×”× ××¢×Ÿ ×”×¨××©×™ (×›×“×™ ×œ×§×‘×œ ××ª ×”"×¢×•×ª×§" ×©× ×©×œ×— ×•×’× ×©×”× ××¢× ×™× ×™×¨××• ×××™ ×”×’×™×¢)
    # ×”× ××¢× ×™× ×”××—×¨×™× ×™×”×™×• ×‘-BCC
    sender_email = "moshei1@verifone.com" 
    
    try:
        outlook = win32.Dispatch("Outlook.Application")
        mail = outlook.CreateItem(0)
        
        # ×œ××™ ×©×•×œ×—×™×? ×œ×¢×¦×× ×•, ×•×”×©××¨ ×‘-BCC ××•×¡×ª×¨
        mail.To = sender_email
        mail.BCC = ";".join(recipients_emails)
        
        mail.Subject = f"×”×˜×™×¤ ×”×™×•××™ ×©×œ×š (V2.3) ğŸ’¡ - {now.strftime('%d/%m/%Y %H:%M:%S')}"
        
        # ×”×˜××¢×ª ×”-GIF ×›-CID
        if temp_gif_path and os.path.exists(temp_gif_path):
            attachment = mail.Attachments.Add(temp_gif_path)
            # Property ID for CID embedding
            attachment.PropertyAccessor.SetProperty("http://schemas.microsoft.com/mapi/proptag/0x3712001E", "daily_visual")
        
        mail.HTMLBody = html_body
        mail.Send()
        print(f"SUCCESS: Sent to {len(recipients_emails)} recipients (BCC), and to: {sender_email}")
        
    except Exception as e:
        print(f"FAILED: Error sending email: {e}")
    finally:
        # × ×™×§×•×™ ×§×•×‘×¥ ×–×× ×™
        if temp_gif_path and os.path.exists(temp_gif_path):
            try: os.remove(temp_gif_path)
            except: pass

if __name__ == "__main__":
    print("--- ××ª×—×™×œ ×”×¤×¦×ª ×˜×™×¤ ×™×•××™ ---")
    send_daily_email()
