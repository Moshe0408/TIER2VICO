# -*- coding: utf-8 -*-
import requests
import base64
import os
import pandas as pd
from datetime import datetime, timedelta
import win32com.client as win32

# ---------------- CONFIG ----------------
ADIR_USER_ID = "9bc2c357-6261-48e3-8562-75674c2b1071"
ADIR_API_KEY = "itVBRDSsaPVYFDlvhKKDnNKRCeZxoOSPvKbO"

BASE_URL = "https://emea.gsc.verifone.cloud/oidc/report-engine/api/v1"

SAVE_DIRS = [
    r"K:\moshe VICO\MosheTools\Shufersal GBX - Giftcard",
    r"J:\VIRD\Shufersal GBX - Giftcard",
    r"C:\Users\Moshei1\OneDrive - Verifone\Desktop\TIP\Shufersal_Giftcard"
]

# ×¡×¤×¨×™×™×” ××¨×›×–×™×ª ×œ××™×—×•×“
MAIN_DIR = SAVE_DIRS[-1]

# ×¢××•×“×•×ª ×œ×”×¡×¨×” ×‘×§×•×‘×¥ ×”×—×•×“×©×™ (×œ×œ× Transaction_type / Transaction_state)
COLUMNS_TO_DROP_IN_MONTHLY = ["Transaction_time", "Created_in_UTC", "OwnerName", "DistributionDate"]

# ---------------- AUTH ----------------
auth_str = f"{ADIR_USER_ID}:{ADIR_API_KEY}"
b64_auth = base64.b64encode(auth_str.encode()).decode()
headers = {"Authorization": f"Basic {b64_auth}"}

# ---------------- HELPERS / MERGE LOGIC ----------------
def merge_dataframe(df: pd.DataFrame) -> pd.DataFrame:
    """
    ××™×–×•×’ ×©×•×¨×•×ª ×œ×¤×™ Merchant_reference + Masked_card_number + Current_amount
    ××• ×œ×¤×™ ×©××•×ª ×”×¢××•×“×•×ª ×‘×¢×‘×¨×™×ª ×‘××§×¨×” ×©×”×§×‘×¦×™× ×›×‘×¨ ×¢×‘×¨×• rename.
    """

    if df is None or df.empty:
        return df

    df = df.fillna('').astype(str).copy()
    
    # × ×™×§×•×™ ×©×•×¨×•×ª ×¨×•×•×— ××• ×©×•×¨×•×ª ×©××™×Ÿ ×‘×”×Ÿ ××™×“×¢ ××™× ×™××œ×™
    # (×©×•×¨×•×ª ×©×‘×”×Ÿ ×›×œ ×”××¤×ª×—×•×ª ×¨×™×§×™× ×”×Ÿ "×–×‘×œ")
    eng_keys = ['Merchant_reference', 'Masked_card_number', 'Current_amount']
    heb_keys = [
        COLUMNS_HEBREW_MAP.get('Merchant_reference', '×§×•×“ ×¡×•×—×¨'),
        COLUMNS_HEBREW_MAP.get('Masked_card_number', '××¡×¤×¨ ×›×¨×˜×™×¡ ××•×¡×ª×¨'),
        COLUMNS_HEBREW_MAP.get('Current_amount', '×¡×›×•× × ×•×›×—×™')
    ]

    if all(k in df.columns for k in eng_keys):
        keys = eng_keys
    elif all(k in df.columns for k in heb_keys):
        keys = heb_keys
    else:
        # ×× ××™×Ÿ ×¢××•×“×•×ª ××¤×ª×—, ×¤×©×•×˜ × ×—×–×™×¨ ××ª ×”-df ×”××§×•×¨×™ ×œ×œ× ×©×™× ×•×™ (××• × ×–×¨×•×§ ×©×’×™××”)
        return df

    # × ×¡× ×Ÿ ×©×•×¨×•×ª ×©×‘×”×Ÿ ×›×œ ×”××¤×ª×—×•×ª ×¨×™×§×™× - ×–×” ×”"×–×‘×œ" ×”×¨××©×•× ×™
    df = df[~(df[keys].apply(lambda x: x.str.strip()).eq('').all(axis=1))]

    df['_orig_idx'] = range(len(df))
    merged_rows = []

    # ××™×–×•×’ ×§×‘×•×¦×•×ª
    for _, group in df.groupby(keys, sort=False):
        # ×× ×”××¤×ª×— ×¨×™×§ (×›×œ×•××¨ ×§×™×‘×œ× ×• ×§×‘×•×¦×” ×©×œ ×©×•×¨×•×ª ×¨×™×§×•×ª ×œ××—×¦×” ×©× ×•×ª×¨×•), 
        # ×× ×—× ×• ×œ× ×¨×•×¦×™× ×œ××—×“ ××•×ª×Ÿ ×œ××—×ª ××œ× ×œ×©××•×¨ ××•×ª×Ÿ ××• ×œ×”×©××™×˜
        # ×›××Ÿ × ×—×œ×™×˜ ×œ×”×©××™×˜ ××•×ª×Ÿ ×× ××™×Ÿ ×œ×”×Ÿ Transaction_ID
        if str(group[keys[0]].iloc[0]).strip() == "" and \
           str(group[keys[1]].iloc[0]).strip() == "" and \
           str(group[keys[2]].iloc[0]).strip() == "":
            # ×”×©××˜×ª ×©×•×¨×•×ª ×©×›×œ ×”××¤×ª×—×•×ª ×©×œ×”×Ÿ ×¨×™×§×™×
            continue

        combined = group.sort_values('_orig_idx').iloc[0].copy()

        for _, r in group.sort_values('_orig_idx').iterrows():
            for col in df.columns:
                if col == '_orig_idx':
                    continue
                if str(combined.get(col, '')).strip() == "" and str(r.get(col, '')).strip() != "":
                    combined[col] = r[col]

        merged_rows.append(combined.drop(labels=['_orig_idx'], errors='ignore'))

    df_merged = pd.DataFrame(merged_rows)
    orig_cols = [c for c in df.columns if c != '_orig_idx']
    df_merged = df_merged.reindex(columns=orig_cols, fill_value='')

    return df_merged


# ---------------- FUNCTIONS ----------------
def last_report_id():
    url = f"{BASE_URL}/reports"
    params = {"pageNumber": 1, "pageSize": 1, "orderBy": "DESC", "orderCriteria": "createdOn"}
    resp = requests.get(url, headers=headers, params=params)
    resp.raise_for_status()
    data = resp.json()
    report_id = data["reports"][0]["reportUid"]
    print("Last Report ID:", report_id)
    return report_id

def download_report(report_id):
    url = f"{BASE_URL}/reports/{report_id}"
    params = {"download": "true"}
    resp = requests.get(url, headers=headers, params=params)
    resp.raise_for_status()

    today_str = datetime.today().strftime("%Y-%m-%d")
    file_name = f"Shufersal_Giftcard_Settled__{today_str}.csv"

    saved_paths = []
    for save_dir in SAVE_DIRS:
        try:
            if not os.path.exists(os.path.splitdrive(save_dir)[0]):
                print(f"âš ï¸ ×›×•× ×Ÿ ×œ× ×–××™×Ÿ: {save_dir}, ××“×œ×’...")
                continue

            os.makedirs(save_dir, exist_ok=True)
            full_path = os.path.join(save_dir, file_name)
            with open(full_path, "wb") as f:
                f.write(resp.content)
            print(f"×”×“×•\"×— ×”×™×•××™ × ×©××¨: {full_path}")
            saved_paths.append(full_path)
        except PermissionError:
            print(f"âš ï¸ ××™×Ÿ ×”×¨×©××” ×œ×›×ª×•×‘ ×œ×ª×™×§×™×™×”: {save_dir}, ××“×œ×’...")

    if not saved_paths:
        raise Exception("âŒ ×œ× ×”×¦×œ×—×ª×™ ×œ×©××•×¨ ××ª ×”×“×•\"×— ×”×™×•××™ ×‘××£ ×ª×™×§×™×™×”")

    return saved_paths[-1]

# ×¡×“×¨ ×¢××•×“×•×ª ×§×‘×•×¢
COLUMNS_ORDER = [
    "Timezone", "Transaction_ID", "Product", "Current_amount", "Current_currency",
    "Transaction_type", "Transaction_state", "Channel", "Masked_card_number",
    "Settlement_date", "Settlement_ID", "Source_PIM", "Merchant_reference",
    "Merchant_ID", "CAVV_result", "3DS_XID", "3DS_authentication_value",
    "phone_number", "Transaction_time"
]

# ××™×¤×•×™ ×©××•×ª ×¢××•×“×•×ª ×œ×¢×‘×¨×™×ª ×‘×œ×‘×“
COLUMNS_HEBREW_MAP = {
    "Organization_name": "×©× ×”××¨×’×•×Ÿ",
    "Created_datetime": "×ª××¨×™×š ×™×¦×™×¨×”",
    "Timezone": "××–×•×¨ ×–××Ÿ",
    "Transaction_ID": "××–×”×” ×¢×¡×§×”",
    "Product": "××•×¦×¨",
    "Current_amount": "×¡×›×•× × ×•×›×—×™",
    "Current_currency": "××˜×‘×¢ × ×•×›×—×™",
    "Transaction_type": "×¡×•×’ ×¢×¡×§×”",
    "Transaction_state": "×¡×˜×˜×•×¡ ×¢×¡×§×”",
    "Channel": "×¢×¨×•×¥",
    "Masked_card_number": "××¡×¤×¨ ×›×¨×˜×™×¡ ××•×¡×ª×¨",
    "Settlement_date": "×ª××¨×™×š ×©×™×“×•×¨",
    "Settlement_ID": "××–×”×” ×©×™×“×•×¨",
    "Source_PIM": "××§×•×¨ PIM",
    "Merchant_reference": "×§×•×“ ×¡×•×—×¨",
    "Merchant_ID": "××–×”×” ×¡×•×—×¨",
    "CAVV_result": "×ª×•×¦××ª CAVV",
    "3DS_XID": "3DS XID",
    "3DS_authentication_value": "×¢×¨×š ××™××•×ª 3DS",
    "phone_number": "××¡×¤×¨ ×˜×œ×¤×•×Ÿ",
    "Transaction_time": "×–××Ÿ ×¢×¡×§×”"
}


def merge_report(csv_file):
    """××™×–×•×’ ×©×•×¨×•×ª ×œ×“×•"×— ×”×™×•××™ + ×™×¦×™×¨×ª phone_number ×•-Transaction_time (+3 ×©×¢×•×ª)"""
    try:
        df = pd.read_csv(csv_file, dtype=str, encoding='utf-8-sig').fillna('')
    except Exception:
        df = pd.read_csv(csv_file, dtype=str, encoding='utf-8').fillna('')

    # × ×™×§×•×™ ×¨×•×•×—×™× ×‘×¢××•×“×•×ª ×§×¨×™×˜×™×•×ª
    for col in ['Merchant_reference', 'Masked_card_number', 'Current_amount']:
        if col in df.columns:
            df[col] = df[col].astype(str).str.strip()

    merged_rows = []
    used_indices = set()

    for idx, row in df.iterrows():
        if idx in used_indices:
            continue

        mask = pd.Series([True] * len(df))
        if 'Merchant_reference' in df.columns:
            mask &= (df['Merchant_reference'] == row.get('Merchant_reference', ''))
        if 'Masked_card_number' in df.columns:
            mask &= (df['Masked_card_number'] == row.get('Masked_card_number', ''))
        if 'Current_amount' in df.columns:
            mask &= (df['Current_amount'] == row.get('Current_amount', ''))

        group = df[mask]

        if 'Transaction_type' in df.columns and 'Transaction_state' in df.columns:
            capture_settled = group[
                (group['Transaction_type'] == 'CAPTURE') &
                (group['Transaction_state'] == 'SETTLED')
            ]
        else:
            capture_settled = pd.DataFrame()

        combined_row = capture_settled.iloc[0].copy() if not capture_settled.empty else row.copy()

        for _, r in group.iterrows():
            for col in df.columns:
                if str(combined_row.get(col, '')).strip() == "" and str(r.get(col, '')).strip() != "":
                    combined_row[col] = r[col]

        merged_rows.append(combined_row)
        used_indices.update(group.index.tolist())

    df_merged = pd.DataFrame(merged_rows, columns=df.columns)
    
    # ×¤×™×œ×˜×•×¨ "×–×‘×œ": × ×©××•×¨ ×¨×§ ×©×•×¨×•×ª ×©×™×© ×œ×”×Ÿ ××–×”×” ×¢×¡×§×” ×•×¡×›×•×
    if 'Transaction_ID' in df_merged.columns:
        df_merged = df_merged[df_merged['Transaction_ID'].str.strip() != '']
    if 'Current_amount' in df_merged.columns:
        df_merged = df_merged[df_merged['Current_amount'].str.strip() != '']

    if 'Merchant_reference' in df_merged.columns:
        df_merged['phone_number'] = df_merged['Merchant_reference'].str[:10]
    else:
        df_merged['phone_number'] = ""

    if 'Created_datetime' in df_merged.columns:
        dt_series = pd.to_datetime(df_merged['Created_datetime'], errors='coerce') + timedelta(hours=3)
        df_merged['Transaction_time'] = dt_series.dt.strftime('%Y-%m-%dT%H:%M:%S.%f').str[:-3] + 'Z'
    elif 'Created_in_UTC' in df_merged.columns:
        dt_series = pd.to_datetime(df_merged['Created_in_UTC'], errors='coerce') + timedelta(hours=3)
        df_merged['Transaction_time'] = dt_series.dt.strftime('%Y-%m-%dT%H:%M:%S.%f').str[:-3] + 'Z'
    else:
        df_merged['Transaction_time'] = "1970-01-01T00:00:00.000Z"

    df_merged['Transaction_type'] = 'CAPTURE'
    df_merged['Transaction_state'] = 'SETTLED'

    # ×©×™× ×•×™ ×©××•×ª ×”×¢××•×“×•×ª ×œ×¢×‘×¨×™×ª ×‘×œ×‘×“
    df_merged.rename(columns=COLUMNS_HEBREW_MAP, inplace=True)
    
    df_merged.to_csv(csv_file, index=False, encoding='utf-8-sig')
    print(f"×”×“×•\"×— ×”×™×•××™ ×”×××•×—×“ × ×©××¨ ×¢× ×©××•×ª ×¢××•×“×•×ª ×‘×¢×‘×¨×™×ª ×‘×œ×‘×“: {csv_file}")
    return csv_file

def merge_all_reports_in_dir(directory, output_file):
    """××™×–×•×’ ×›×œ ×”×“×•×—×•×ª ×”×™×•××™×™× ×©×œ ×”×—×•×“×© ×”× ×•×›×—×™ ×‘×œ×‘×“ ×œ×ª×•×š ×§×•×‘×¥ ×—×•×“×©×™ ××¦×˜×‘×¨"""
    current_year = datetime.today().year
    current_month = datetime.today().month

    all_files = []
    for f in os.listdir(directory):
        if f.endswith(".csv") and f.startswith("Shufersal_Giftcard_Settled__"):
            try:
                date_str = f.split("__")[1].replace(".csv", "")
                file_date = datetime.strptime(date_str, "%Y-%m-%d")
                if file_date.year == current_year and file_date.month == current_month:
                    all_files.append(os.path.join(directory, f))
            except Exception:
                continue

    if not all_files:
        raise Exception(f"âŒ ×œ× × ××¦××• ×§×‘×¦×™× ×™×•××™×™× ×¢×‘×•×¨ {current_month}/{current_year} ×‘×ª×™×§×™×™×”: {directory}")

    df_list = []
    for f in all_files:
        try:
            # × × ×¡×” ×œ×§×¨×•× ×¢× utf-8-sig ×›×“×™ ×œ×˜×¤×œ ×‘-BOM
            df = pd.read_csv(f, dtype=str, encoding='utf-8-sig').fillna('')
        except Exception:
            # fallback ×œ-windows-1255 ×× × ×“×¨×©
            df = pd.read_csv(f, dtype=str, encoding='windows-1255').fillna('')
        df_list.append(df)
        
    df_all = pd.concat(df_list, ignore_index=True)

    # × ×¨××•×œ ×©××•×ª ×¢××•×“×•×ª: ×× ×”×§×•×‘×¥ ×›×‘×¨ ×¢× ×¢×‘×¨×™×ª, × ×—×–×™×¨ ×œ×× ×’×œ×™×ª ×–×× ×™×ª ×œ×¦×•×¨×š ×”××™×–×•×’
    # ×× ×—× ×• ×¦×¨×™×›×™× ×©×”××™×–×•×’ ×™×¢×‘×•×“ ×œ×¤×™ ××¤×ª×— ××—×™×“.
    
    # ××™×¤×•×™ ×”×¤×•×š: ××¢×‘×¨×™×ª ×œ×× ×’×œ×™×ª
    REVERSE_HEBREW_MAP = {v: k for k, v in COLUMNS_HEBREW_MAP.items()}
    
    # × × ×¡×” ×œ×”××™×¨ ×©××•×ª ×¢××•×“×•×ª ×‘×× ×’×œ×™×ª ×× ×”× ×‘×¢×‘×¨×™×ª
    new_columns = []
    for col in df_all.columns:
        if col in REVERSE_HEBREW_MAP:
            new_columns.append(REVERSE_HEBREW_MAP[col])
        else:
            new_columns.append(col)
    
    df_all.columns = new_columns
    
    # ×›×¢×ª ×”×¤×•× ×§×¦×™×” merge_dataframe ×ª×¢×‘×•×“ ×¨×’×™×œ ×›×™ ×”×¢××•×“×•×ª ×‘×× ×’×œ×™×ª
    df_merged = merge_dataframe(df_all)

    if 'Merchant_reference' in df_merged.columns:
        df_merged['phone_number'] = df_merged['Merchant_reference'].str[:10]
    else:
        df_merged['phone_number'] = ""

    if 'Created_datetime' in df_merged.columns:
        def fill_transaction_time(row):
            if not row.get('Transaction_time') or row['Transaction_time'].strip() == '':
                dt = pd.to_datetime(row['Created_datetime'], errors='coerce')
                if pd.notnull(dt):
                    return (dt + timedelta(hours=3)).strftime('%Y-%m-%dT%H:%M:%S.%f')[:-3] + 'Z'
            return row.get('Transaction_time', '')
        df_merged['Transaction_time'] = df_merged.apply(fill_transaction_time, axis=1)

    elif 'Created_in_UTC' in df_merged.columns:
        def fill_transaction_time(row):
            if not row.get('Transaction_time') or row['Transaction_time'].strip() == '':
                dt = pd.to_datetime(row['Created_in_UTC'], errors='coerce')
                if pd.notnull(dt):
                    return (dt + timedelta(hours=3)).strftime('%Y-%m-%dT%H:%M:%S.%f')[:-3] + 'Z'
            return row.get('Transaction_time', '')
        df_merged['Transaction_time'] = df_merged.apply(fill_transaction_time, axis=1)
    else:
        df_merged['Transaction_time'] = "1970-01-01T00:00:00.000Z"

    df_merged['Transaction_type'] = 'CAPTURE'
    df_merged['Transaction_state'] = 'SETTLED'

    # ×”×©××˜×ª ×¢××•×“×•×ª ×©×‘×™×§×©×ª ×œ×”×¡×™×¨ (×× ×”×Ÿ ×§×™×™××•×ª)
    if COLUMNS_TO_DROP_IN_MONTHLY:
        df_merged.drop(columns=[c for c in COLUMNS_TO_DROP_IN_MONTHLY if c in df_merged.columns and c != 'Transaction_time'], inplace=True, errors='ignore')

    # ×¤×™×œ×˜×•×¨ "×–×‘×œ" ×¡×•×¤×™ ×œ×¤× ×™ ×”×©××™×¨×”: ×¨×§ ×©×•×¨×•×ª ×¢× ××–×”×” ×¢×¡×§×” ×•×¡×›×•×, ×•×œ×œ× ×ª××¨×™×š 1970
    if 'Transaction_ID' in df_merged.columns:
        df_merged = df_merged[df_merged['Transaction_ID'].str.strip() != '']
    if 'Current_amount' in df_merged.columns:
        df_merged = df_merged[df_merged['Current_amount'].str.strip() != '']
    if 'Transaction_time' in df_merged.columns:
        df_merged = df_merged[df_merged['Transaction_time'] != "1970-01-01T00:00:00.000Z"]

    df_merged = df_merged.reindex(columns=[c for c in COLUMNS_ORDER if c in df_merged.columns], fill_value='')

    # ×©×™× ×•×™ ×©××•×ª ×”×¢××•×“×•×ª ×œ×¢×‘×¨×™×ª ×‘×œ×‘×“
    df_merged.rename(columns=COLUMNS_HEBREW_MAP, inplace=True)

    df_merged.to_csv(output_file, index=False, encoding='utf-8-sig')
    print(f"ğŸ“‚ ×§×•×‘×¥ ×—×•×“×©×™ ××¦×˜×‘×¨ × ×©××¨ ×¢× ×©××•×ª ×¢××•×“×•×ª ×‘×¢×‘×¨×™×ª ×‘×œ×‘×“: {output_file}  (×©×•×¨×•×ª: {len(df_merged)})")
    return output_file


def send_email_with_attachments(to_recipients, subject, body, attachment_paths, cc_recipients=None):
    """×©×œ×™×—×ª ××™×™×œ ××§×¦×•×¢×™ ×•××•×“×¨× ×™ ×¢× ×§×‘×¦×™× ××¦×•×¨×¤×™×"""
    outlook = win32.Dispatch("Outlook.Application")
    mail = outlook.CreateItem(0)
    mail.To = "; ".join(to_recipients)
    if cc_recipients:
        mail.CC = "; ".join(cc_recipients)
    mail.Subject = subject

    # ----- HTML ××•×“×¨× ×™ ×•× ×§×™ -----
    body_html = f"""
    <html>
    <body style="
        direction: rtl; 
        text-align: right; 
        font-family: 'Segoe UI', Arial, sans-serif; 
        font-size: 15px; 
        color: #2c2c2c; 
        background-color: #ffffff;
    ">

        <!-- ×›×•×ª×¨×ª ×¢×œ×™×•× ×” ××•×“×¨× ×™×ª -->
        <div style="
            background-color: #0066cc; 
            padding: 16px 22px; 
            color: white; 
            font-size: 18px; 
            font-weight: 600; 
            border-radius: 6px;
        ">
            ×“×•"×— ×’×™×¤×˜×§××¨×“ ×©×•×¤×¨×¡×œ
        </div>

        <!-- ×¨×™×•×•×— -->
        <div style="height: 20px;"></div>

        <!-- ×ª×•×›×Ÿ -->
        <p style="margin: 0 0 14px 0;">
            ×©×œ×•×,
        </p>

        <p style="margin: 0 0 22px 0; line-height: 1.6;">
            ××¦×•×¨×£ ×“×•×— ×¢×¡×§××•×ª ×’×™×¤×˜×§××¨×“ ×©×•×¤×¨×¡×œ â€“ ×™×•××™ ×•××¦×˜×‘×¨ ×—×•×“×©×™.
        </p>

        <!-- ×—×ª×™××” -->
        <p style="margin-top: 28px; line-height: 1.6;">
            ×‘×‘×¨×›×”,<br>
            <span style="font-weight: 600; color: #0066cc;">Verifone Israel</span>
        </p>

    </body>
    </html>
    """

    mail.HTMLBody = body_html

    # ×”×•×¡×¤×ª ×§×‘×¦×™×
    for path in attachment_paths:
        if path and os.path.exists(path):
            mail.Attachments.Add(path)
            print(f"ğŸ“ ××¦×•×¨×£ ×œ××™×™×œ: {path}")
        else:
            print(f"âš ï¸ ×§×•×‘×¥ ×œ× × ××¦×: {path}")

    mail.Send()
    print("ğŸ“§ ×”××™×™×œ × ×©×œ×— ×‘×”×¦×œ×—×”.")


# ---------------- MAIN ----------------
if __name__ == "__main__":
    report_id = last_report_id()

    # ×”×•×¨×“×ª ×”×“×•"×— ×”×™×•××™ ×•×©××™×¨×ª×• ×‘×ª×™×§×™×•×ª
    daily_file = download_report(report_id)

    # × ×¨×™×¥ ××ª ××™×–×•×’/× ×™×§×•×™ ×¢×œ ×”×“×•"×— ×”×™×•××™
    merge_report(daily_file)

    # × ×™×¦×•×¨/× ×¢×“×›×Ÿ ××ª ×”×§×•×‘×¥ ×”×—×•×“×©×™ ×”××¦×˜×‘×¨
    month_name = datetime.today().strftime("%B")  # ×œ××©×œ "September"
    monthly_file = os.path.join(MAIN_DIR, f"Shufersal 3DS - Cumulative_{month_name}.csv")
    merged_file = merge_all_reports_in_dir(MAIN_DIR, monthly_file)

    recipients = ["verifone3dslog@shufersal.co.il"]
    cc_recipients = [
        "nadav.lieber@verifone.com",
        "eli.nachmani@verifone.com",
        "moshei1@verifone.com",
        "shufersal@verifone.com"
    ]

    send_email_with_attachments(
        recipients,
        subject=f'×“×•\"×— ×’×™×¤×˜×§××¨×“ ×©×•×¤×¨×¡×œ {datetime.today().strftime("%Y-%m-%d")}',
        body="×©×œ×•× ,\n\n××¦×•×¨×£ ×“×•×— ×¢×¡×§××•×ª ×’×™×¤×˜×§××¨×“ ×©×•×¤×¨×¡×œ - ×™×•××™ ×•××¦×˜×‘×¨ ×—×•×“×©×™.\n\n×‘×‘×¨×›×”,\n×•×¨×™×¤×•×Ÿ",
        attachment_paths=[daily_file, merged_file],
        cc_recipients=cc_recipients
    )

